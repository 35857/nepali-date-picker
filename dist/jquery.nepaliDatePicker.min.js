var calenderFunctions={};(function(b){var a={bsMonths:["बैशाख","जेठ","असार","सावन","भदौ","असोज","कार्तिक","मंसिर","पौष","माघ","फागुन","चैत"],bsDays:["आईत","सोम","मंगल","बुध","बिही","शुक्र","शनि"],nepaliNumbers:["०","१","२","३","४","५","६","७","८","९"],bsMonthUpperDays:[[30,31],[31,32],[31,32],[31,32],[31,32],[30,31],[29,30],[29,30],[29,30],[29,30],[29,30],[30,31]],extractedBsMonthData:[[1,3,1,22,1,3,1,3,1,22,1,3,1,19,1,3,1,1,3],[0,1,2,2,2,1,3,1,3,1,2,2,2,2,2,2,2,2,2,2,2,1,3,1,2,2,2,2,2,2,2,2,2,2,2,1,3,1,2,2,2,2,2,1,1,1,2,2,2,2],[1,2,2,2,2,2,2,2,2,1,3,1,3,1,2,2,2,2,2,2,2,2,2,1,3,1,3,1,2,2,2,2,2,2,2,2,2,1,3,1,3,1,1,1,1,2,2,2,2],[0,1,1,3,1,3,1,3,1,3,1,3,1,3,1,2,2,2,1,3,1,3,1,3,1,3,1,3,1,2,2,2,1,3,1,3,1,3,1,3,1,3,1,3,2,2,1,3],[29,1,26,1,28,1,2,1,2],[1,1,3,1,2,2,2,2,2,2,2,2,2,2,2,1,3,1,2,2,2,2,2,2,2,2,2,2,2,1,3,1,2,2,2,2,2,2,2,2,2,2,5,1,1,2,2],[0,8,1,3,1,3,1,18,1,3,1,3,1,18,1,3,1,3,1,20],[0,1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,11],[1,2,2,2,1,3,1,3,1,3,1,2,2,2,2,2,2,2,1,3,1,3,1,3,1,2,2,2,2,2,2,2,2,2,1,3,1,3,1,2,2,2,11],[0,1,3,1,14,1,3,1,3,1,3,1,18,1,3,1,3,1,3,1,14,1,3,10],[1,3,1,3,1,10,1,3,1,3,1,3,1,3,1,14,1,3,1,3,1,3,1,3,1,10,1,13],[0,1,2,2,2,2,2,1,3,1,3,1,3,1,2,2,2,2,2,2,2,1,3,1,3,1,3,1,3,1,2,2,2,2,2,2,2,1,3,1,3,1,13]],minBsYear:2000,maxBsYear:2090,minAdDateEqBsDate:{ad:{year:1943,month:3,date:14},bs:{year:2000,month:1,date:1}}};b.extend(calenderFunctions,{getNepaliNumber:function(e){var d=Math.floor(e/10);var c=e%10;if(d!=0){return calenderFunctions.getNepaliNumber(d)+a.nepaliNumbers[c]}else{return a.nepaliNumbers[c]}},getNumberByNepaliNumber:function(f){var e=0;for(var c=0;c<f.length;c++){var d=a.nepaliNumbers.indexOf(f.charAt(c));e=e*10+d}return e},getBsMonthInfoByBsDate:function(c,m,k,j){if(c<a.minBsYear||c>a.maxBsYear){return null}var e=calenderFunctions.getTotalDaysNumFromMinBsYear(c,m,k);var i=new Date(a.minAdDateEqBsDate.ad.year,a.minAdDateEqBsDate.ad.month,a.minAdDateEqBsDate.ad.date-1);i.setDate(i.getDate()+e);var d=calenderFunctions.getAdDateByBsDate(c,m,1);var g=calenderFunctions.getBsMonthDays(c,m);k=(k>g)?g:k;var l=calenderFunctions.getAdDateByBsDate(c,m,k);var h=l.getDay();var f=calenderFunctions.bsDateFormat(j,c,m,k,h);return{bsYear:c,bsMonth:m,bsDate:k,weekDay:h,formattedDate:f,adDate:l,bsMonthFirstAdDate:d,bsMonthDays:g}},getAdDateByBsDate:function(c,d,f){var e=calenderFunctions.getTotalDaysNumFromMinBsYear(c,d,f);var g=new Date(a.minAdDateEqBsDate.ad.year,a.minAdDateEqBsDate.ad.month,a.minAdDateEqBsDate.ad.date-1);g.setDate(g.getDate()+e);return g},getTotalDaysNumFromMinBsYear:function(e,f,c){if(e<a.minBsYear||e>a.maxBsYear){return null}var g=0;var d=e-a.minBsYear;for(var h=0;h<12;h++){if(h<=f){g+=calenderFunctions.getMonthDaysNumFormMinBsYear(h,d)}else{if(d>0){g+=calenderFunctions.getMonthDaysNumFormMinBsYear(h,d-1)}}}return g+=c},getMonthDaysNumFormMinBsYear:function(d,c){var k=0;var j=0;var h=(d-1!=-1)?d-1:11;if(c==0&&h==11){return 0}if(h==11){c-=1}var f=a.extractedBsMonthData[h];for(var e=0;e<f.length;e++){if(f[e]==0){continue}var g=e%2;if(c>=k+f[e]){k+=f[e];j+=a.bsMonthUpperDays[h][g]*f[e]}else{j+=a.bsMonthUpperDays[h][g]*(c-k+1);k=c;break}}return j},getBsMonthDays:function(d,e){var j=0;var c=d-a.minBsYear;var g=a.extractedBsMonthData[e];for(var f=0;f<g.length;f++){if(g[f]==0){continue}var h=f%2;j+=g[f];if(c<=j){return a.bsMonthUpperDays[e][h]}}return null},getBsDateByAdDate:function(d,i,h){var c=d+57;var k=(i+9)%12;var j=1;if(i<3){c-=1}else{if(i==3){var f=calenderFunctions.getAdDateByBsDate(c,0,1);if(h<f.getDate()){c-=1}}}var e=calenderFunctions.getAdDateByBsDate(c,k,1);if(h>=1&&h<e.getDate()){k=(k!=0)?k-1:11;var g=calenderFunctions.getBsMonthDays(c,k);j=g-(e.getDate()-h)+1}else{j=h-e.getDate()+1}return{bsYear:c,bsMonth:k,bsDate:j}},getBsYearByAdDate:function(d,e,f){var c=calenderFunctions.getBsDateByAdDate(d,e,f);return c.bsYear},getBsMonthByAdDate:function(d,e,f){var c=calenderFunctions.getBsDateByAdDate(d,e,f);return c.bsMonth},bsDateFormat:function(g,e,f,c,d){var h=g;h=h.replace(/%d/g,calenderFunctions.getNepaliNumber(c));h=h.replace(/%y/g,calenderFunctions.getNepaliNumber(e));h=h.replace(/%m/g,f);h=h.replace(/%M/g,a.bsMonths[f]);h=h.replace(/%D/g,a.bsDays[d]);return h},parseFormattedBsDate:function(d,k){var c=0;var e={bsYear:null,bsMonth:null,bsDate:null,bsDay:null};for(var g=0;g<d.length;g++){if(d.charAt(g)=="%"){var m=d.substring(g,g+2);var f=d.charAt(g+2);var l=k.substring(g+c);var h=(f!="")?l.indexOf(f):l.length;var j=l.substring(0,h);if(m=="%y"){e.bsYear=calenderFunctions.getNumberByNepaliNumber(j);c+=j.length-2}else{if(m=="%d"){e.bsDate=calenderFunctions.getNumberByNepaliNumber(j);c+=j.length-2}else{if(m=="%D"){e.bsDay=a.bsDays.indexOf(j);c+=j.length-2}else{if(m=="%m"){e.bsMonth=calenderFunctions.getNumberByNepaliNumber(j);c+=j.length-2}else{if(m=="%M"){e.bsMonth=a.bsMonths.indexOf(j);c+=j.length-2}}}}}}}return e}});b.fn.nepaliDatePicker=function(c){var d={options:b.extend({dateFormat:"%D, %M %d, %y",closeOnDateSelect:true,defaultDate:"",minDate:null,maxDate:null,yearStart:a.minBsYear,yearEnd:a.maxBsYear},c),init:function(e){e.prop("readonly",true);var f=b('<div class="nepali-date-picker">');b("body").append(f);if(e.val()!=""){d.renderFormattedSpecificDateCalender(f,d.options.dateFormat,e.val())}else{d.renderCurrentMonthCalender(f)}d.addEventHandler(e,f)},addCommonEventHandler:function(){var e=b(".nepali-date-picker");b(document).click(function(f){var g=b(f.target);if(!g.parents(b(".nepali-date-picker")).length){e.hide();e.find(".drop-down-content").hide()}})},addEventHandler:function(e,f){e.focus(function(){b(".nepali-date-picker").hide();var g=b(this).position();f.css({top:g.top+b(this).outerHeight,left:g.left});f.show();d.eventFire(e,f,"show")});e.click(function(){b(".nepali-date-picker").hide();var g=b(this).position();f.css({top:g.top+b(this).outerHeight,left:g.left});f.show();d.eventFire(e,f,"show")});f.on("click",".next-btn",function(g){g.preventDefault();var h={bsYear:f.data().bsYear,bsMonth:f.data().bsMonth,bsDate:f.data().bsDate};d.renderNextMonthCalender(f);d.triggerChangeEvent(e,f,h);f.show()});f.on("click",".prev-btn",function(h){h.preventDefault();var i={bsYear:f.data().bsYear,bsMonth:f.data().bsMonth,bsDate:f.data().bsDate};d.renderPreviousMonthCalender(f);var g=f.data();d.triggerChangeEvent(e,f,i);f.show()});f.on("click",".today-btn",function(h){h.preventDefault();var i={bsYear:f.data().bsYear,bsMonth:f.data().bsMonth,bsDate:f.data().bsDate};d.renderCurrentMonthCalender(f);var g=f.data();d.triggerChangeEvent(e,f,i);f.show()});f.on("click",".current-year-txt, .current-month-txt",function(){if(!b(this).find(".drop-down-content").is(":visible")){f.find(".drop-down-content").hide();b(this).find(".drop-down-content").show();var h=b(this).find(".option-wrapper");h.scrollTop(0);var g=h.find(".active").position().top;h.scrollTop(g)}else{b(this).find(".drop-down-content").hide()}});f.on("click",".current-month-date",function(){if(b(this).hasClass("disable")){return}var h=f.data();var i=h.bsYear;var k=h.bsMonth;var l=h.bsDate;var g=b(this).data("date");var j=b(this).data("weekday");var m=calenderFunctions.bsDateFormat(d.options.dateFormat,i,k,g,j);e.val(m);d.setCalenderDate(f,i,k,g);d.renderMonthCalender(f);d.eventFire(e,f,"select");if(l!=g){d.eventFire(e,f,"dateChange")}if(d.options.closeOnDateSelect){f.hide()}else{f.show()}});f.on("click",".drop-down-content li",function(){var j=b(this).parents(".drop-down-content");j.data("value",b(this).data("value"));j.attr("data-value",b(this).data("value"));var l={bsYear:f.data().bsYear,bsMonth:f.data().bsMonth,bsDate:f.data().bsDate};var i=f.find(".month-drop-down").data("value");var h=f.find(".year-drop-down").data("value");var g=l.bsDate;d.setCalenderDate(f,h,i,g);d.renderMonthCalender(f);var k=f.data();d.triggerChangeEvent(e,f,l);f.show()})},triggerChangeEvent:function(e,f,h){var g=f.data();if(h.bsYear!=g.bsYear){d.eventFire(e,f,"yearChange")}if(h.bsMonth!=g.bsMonth){d.eventFire(e,f,"monthChange")}if(h.bsDate!=g.bsDate){d.eventFire(e,f,"dateChange")}},eventFire:function(e,g,f){switch(f){case"generate":e.trigger({type:f,message:"Nepali date picker initialize",datePickerData:g.data(),time:new Date()});break;case"show":e.trigger({type:f,message:"Show nepali date picker",datePickerData:g.data(),time:new Date()});break;case"close":e.trigger({type:f,message:"close nepali date picker",datePickerData:g.data(),time:new Date()});break;case"select":e.trigger({type:f,message:"Select date",datePickerData:g.data(),time:new Date()});break;case"dateChange":e.trigger({type:f,message:"Change date",datePickerData:g.data(),time:new Date()});break;case"monthChange":e.trigger({type:f,message:"Change month",datePickerData:g.data(),time:new Date()});break;case"yearChange":e.trigger({type:f,message:"Change year",datePickerData:g.data(),time:new Date()});break;default:break}},setCalenderDate:function(g,e,f,h){g.data(calenderFunctions.getBsMonthInfoByBsDate(e,f,h,d.options.dateFormat))},renderMonthCalender:function(e){e.find(".calender-wrapper").remove();e.append(d.getCalender(e)).hide()},getCalender:function(e){var f=b('<div class="calender-wrapper">');f.append(d.getCalenderController(e));var g=b("<table>");g.append(d.getCalenderHeader());g.append(d.getCalenderBody(e));f.append(g);return f},getCalenderController:function(f){var e=b("<div class='calender-controller'>");e.append('<a href="javascript:void(0);" class="prev-btn icon" title="prev"></a>');e.append('<a href="javascript:void(0);" class="today-btn icon" title=""></a>');e.append(d.getMonthDropOption(f));e.append(d.getYearDropOption(f));e.append('<a href="javascript:void(0);" class="next-btn icon" title="next"></a>');return e},getMonthDropOption:function(j){var f=j.data();var e=b('<div class="current-month-txt">');e.text(a.bsMonths[f.bsMonth]);e.append('<i class="icon icon-drop-down">');var k=[];for(var h=0;h<12;h++){k.push({label:a.bsMonths[h],value:h})}var g=d.getCustomSelectOption(k,f.bsMonth).addClass("month-drop-down");e.append(g);return e},getYearDropOption:function(h){var e=h.data();var f=b('<div class="current-year-txt">');f.text(calenderFunctions.getNepaliNumber(e.bsYear));f.append('<i class="icon icon-drop-down">');var j=[];for(var g=d.options.yearStart;g<=d.options.yearEnd;g++){j.push({label:calenderFunctions.getNepaliNumber(g),value:g})}var k=d.getCustomSelectOption(j,e.bsYear).addClass("year-drop-down");f.append(k);return f},getCustomSelectOption:function(e,g){var h=b('<div class="drop-down-content" data-value="'+g+'">');var i=b('<div class="option-wrapper">');var f=b("<ul>");b.each(e,function(j,k){f.append('<li data-value="'+k.value+'">'+k.label+"</li>")});i.append(f);f.find('li[data-value="'+g+'"]').addClass("active");h.append(i);return h},getCalenderHeader:function(){var g=b("<thead>");var e=b("<tr>");for(var f=0;f<7;f++){e.append("<td>"+a.bsDays[f]+"</td>")}g.append(e);return g},getCalenderBody:function(m){var p=m.data();var e=Math.ceil((p.bsMonthFirstAdDate.getDay()+p.bsMonthDays)/7);var j=(p.bsMonth-1!=-1)?p.bsMonth-1:11;var u=j==11?p.bsYear-1:p.bsYear;var s=calenderFunctions.getBsMonthDays(u,j);var t=null;var r=null;if(d.options.minDate!=null){t=calenderFunctions.parseFormattedBsDate(d.options.dateFormat,d.options.minDate)}if(d.options.maxDate!=null){r=calenderFunctions.parseFormattedBsDate(d.options.dateFormat,d.options.maxDate)}var q=b("<tbody>");for(var o=0;o<e;o++){var h=b("<tr>");for(var l=1;l<=7;l++){var n=(o*7)+l-p.bsMonthFirstAdDate.getDay();var f=true;if(n<=0){n=s+n;f=false}else{if(n>p.bsMonthDays){n=n-p.bsMonthDays;f=false}}if(f){var g=b('<td class="current-month-date" data-date="'+n+'" data-weekDay="'+(l-1)+'">'+calenderFunctions.getNepaliNumber(n)+"</td>");if(n==p.bsDate){g.addClass("active")}d.disableIfOutOfRange(g,p,t,r,n);h.append(g)}else{h.append('<td class="other-month-date">'+calenderFunctions.getNepaliNumber(n)+"</td>")}}q.append(h)}return q},disableIfOutOfRange:function(i,e,h,g,f){if(h!=null){if(e.bsYear<h.bsYear){i.addClass("disable")}else{if(e.bsYear==h.bsYear&&e.bsMonth<h.bsMonth){i.addClass("disable")}else{if(e.bsYear==h.bsYear&&e.bsMonth==h.bsMonth&&f<h.bsDate){i.addClass("disable")}}}}if(g!=null){if(e.bsYear>g.bsYear){i.addClass("disable")}else{if(e.bsYear==g.bsYear&&e.bsMonth>g.bsMonth){i.addClass("disable")}else{if(e.bsYear==g.bsYear&&e.bsMonth==g.bsMonth&&f>g.bsDate){i.addClass("disable")}}}}return i},renderCurrentMonthCalender:function(i){var f=new Date();var j=calenderFunctions.getBsDateByAdDate(f.getFullYear(),f.getMonth(),f.getDate());var g=j.bsYear;var h=j.bsMonth;var e=j.bsDate;d.setCalenderDate(i,g,h,e);d.renderMonthCalender(i)},renderPreviousMonthCalender:function(g){var f=g.data();var i=(f.bsMonth-1>=0)?f.bsMonth-1:11;var e=(i!=11)?f.bsYear:f.bsYear-1;var h=f.bsDate;if(e<d.options.yearStart||e>d.options.yearEnd){return null}d.setCalenderDate(g,e,i,h);d.renderMonthCalender(g)},renderNextMonthCalender:function(f){var e=f.data();var g=(e.bsMonth+1<=11)?e.bsMonth+1:0;var i=(g!=0)?e.bsYear:e.bsYear+1;var h=e.bsDate;if(i<d.options.yearStart||i>d.options.yearEnd){return null}d.setCalenderDate(f,i,g,h);d.renderMonthCalender(f)},renderFormattedSpecificDateCalender:function(f,e,h){var g=calenderFunctions.parseFormattedBsDate(e,h);d.setCalenderDate(f,g.bsYear,g.bsMonth,g.bsDate);d.renderMonthCalender(f)}};this.each(function(){var e=b(this);d.init(e)});d.addCommonEventHandler();return this}}(jQuery,calenderFunctions));